# 프로그램, 프로세스, 스레드

> - 프로그램이란 특정 작업을 수행하기 위한 실행파일이다. 실행파일을 클릭했을 때 메모리 할당이 이루어지고, 이 메모리공간으로 코드가 올라간다. 이 순간부터 프로세스이다.
> - 프로세스는 OS로부터 자원을 할당받는 실행되고 있는 프로그램의 인스턴스이다. 각각 독립된 메모리 영역(Code, Data, Stack, Heap 구조) 등을 할당받는다. 
> - 스레드는 프로세스의 가장 작은 실행단위로, 프로세스가 할당받은 자원을 이용한다. 프로세스 내에서 각각 stack과 PC 레지스터만 따로 할당받고 Code, Data, Heap 영역은 프로세스 내에 쓰레드끼리 공유하면서 실행된다.
> - 스레드를 사용하면 응답시간 단축, 빠른 통신과 비용적음, 빠른 문맥 교환, 시스템 처리량을 향상시킬 수 있지만, 스레드의 자원 공유는 동기화 문제에 신경을 써야하며 멀티스레드 프로그래밍은 구현과 디버깅이 어렵다는 문제점이 있다.

## 프로그램(Programe)이란?

- **특정 작업을 수행하기 위해** 작성된 일련의 지침을 포함하는 **실행 파일**

- 컴퓨터의 주 메모리에 저장되지 않고, 디스크 또는 컴퓨터의 **보조 메모리에 저장**된다.

- 프로그램은 주 메모리에서 읽고 커널에 의해 실행된다

  ex) chrome.exe (웹 페이지 보기), notepad.exe (텍스트 파일 편집)

- **특징**
  - **수동적(정적) 개체(passive entity)**. 실행할 명령어 그룹을 저장.<br/>당장  실행파일을 열어보면 다양한 명령어가 적혀있는 것을 알 수 있다. 이러한 명령어를 그룹으로 모아저 저장하는 것이 프로그램!
  - 수동으로 **삭제할 때까지 메모리에 저장**된다.
  - 프로그램은 **실행 없이 어떤 작업도 수행 불가능.**

## 프로세스(Process)란?

> program is in execution (실행 중인 프로그램)

- 메모리에 올라와 **실행되고 있는 프로그램의 인스턴스(독립적인 개체)**

- 프로그램이 실행되는 실행 단위

- 프로그램 실행 중에 생성되어 **주 메모리에 load**된다.

  ex) google 크롬 아이콘을 더블 클릭하면 크롬 프로그램을 실행하는 프로세스가 시작된다.

- **특징**

  - **능동적(동적) 개체(active entity)**. 응용 프로그램의 목적을 수행함
  - **수명이 매우 제한적**. 작업이 완료되면 종료된다.
  - 프로세스에는 OS로부터 **실행에 필요한 자원을 할당**받는다.<br/>ex) 파일 디스크립터(file descriptors), 네트워크 포트, cpu시간, 메모리 영역(Code, Data, Stack, Heap 구조)
  - 여러 프로세스가 동일한 프로그램과 관련될 수 있다.<br/>ex) 메모장 프로그램의 여러 인스턴스 실행 가능 (각 인스턴스 = 프로세스)
  - 프로세스에 대한 정보는 **PCB(Process Control Block)**에 저장된다. 

### PCB(Process Control Block)

> 특정 프로세스에 대한 중요한 정보를 저장하고 있는 운영체제의 자료구조

- 사용자가 프로세스를 생성할 때마다 운영체제는 해당 프로세스에 해당하는 PCB를 생성한다. 

- **[PCB]에 저장되는 정보**

| 이름                                   | 정의                                                         |
| -------------------------------------- | ------------------------------------------------------------ |
| 프로세스 식별자 (Process-Id, PID)      | 프로세스 식별 번호                                           |
| 프로세스 상태 (Process state)          | new, ready, running, waiting, terminated 등의 상태를 저장    |
| 프로세스 우선순위 (Process Priority)   | 수명, 소비한 자원 등으로 우선순위 나눔<br />숫자 값이 작을수록 해당 프로세스의 우선 순위 증가 |
| 회계정보 (Accounting Information)      | 사용된 CPU 양과 시간, 시간 제한, 계정 번호 등 제공           |
| 프로그램 카운터 (Program Counter, PC)  | 프로세스가 다음에 실행할 명령어의 주소 저장                  |
| CPU 레지스터 (CPU Registers)           | 인터럽트 발생 or 프로세스 간 문맥 교환 발생 시 임시 정보 저장. |
| PCB 포인터 (PCB Pointers)              | 프로세스 상태가 ready인 다음 PCB 주소 저장                   |
| 열린 파일 목록 (List of Open Files)    | 프로그램이 실행되는 동안 필요한 모든 파일 정보 저장          |
| I/O 상태 정보 (I/O status Information) | 프로세스에 할당된 입출력 장치 목록 저장                      |

## 프로세스 상태 (Process State)

![프로세스_상태도](https://github.com/KJY97/Note/blob/main/img/OS/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4_%EC%83%81%ED%83%9C%EB%8F%84.png?raw=true)

- **New** : 프로세스가 생성중인 상태

- **Running** : CPU를 잡고 명령어(instruction)를 수행중인 상태
- **Ready** : CPU를 기다리는 상태 (다른 조건을 다 만족하고 CPU만 얻으면 되는 상태를 의미)
- **Blocked(wait, sleep)** : CPU를 주어도 당장 명령어(instruction)을 수행할 수 없는 상태
  - Process 자신이 요청한 event(예: I/O)가 즉시 만족되지 않아 이를 기다리는 상태
  - ex) 디스크에서 file을 읽어와야 하는 경우
- **Terminated** : 수행(execution)이 끝난 상태

## 프로그램과 프로세스 차이점

|           | 프로그램                                         | 프로세스                         |
| --------- | ------------------------------------------------ | -------------------------------- |
| 정의      | 프로그래밍 목표를 달성하기 위해 정렬된 작업 그룹 | 실행 중인 프로그램               |
| 상주 위치 | 디스크 or 보조 메모리                            | 주 메모리                        |
| 개체 유형 | 정적, 수동적 개체(passive entity)                | 동적, 능동적 개체(active entity) |
| 자원 관리 | 명령어 저장을 위한 메모리만 필요                 | 리소스 요구사항이 매우 높음      |
| 수명      | 수명이 길다. (삭제 전까지 저장됨)                | 수명이 짧고 매우 제한적          |



## 스레드(Thread)

> 프로세스 내의 실행 흐름

![스레드](https://i0.wp.com/javaconceptoftheday.com/wp-content/uploads/2014/11/ThreadsAndProcesses.png?w=1200)

- 프로세스의 **실행 가능한 가장 작은 단위**

- 프로세스는 동시에 실행되는 여러 스레드를 가질 수 있다.

  - 이러한 프로세스를 경량 프로세스(Lightweight Process) 라고도 부른다.

- **분류**

  | User Threads            | Kernal Threads        |
  | ----------------------- | --------------------- |
  | 사용자에 의해 구현      | OS에 의해 구현        |
  | 구현이 쉬움             | 구현 복잡             |
  | 종속 스레드로 설계      | 독립 스레드로 설계    |
  | 문맥 교환 시간이 짧음   | 문맥 교환 시간이 길다 |
  | 하드웨어 지원 필요 없음 | 하드웨어 지원 필요    |

### 멀티 스레딩

**하나의 프로세스를 다수의 실행 단위로 구분**하여 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 **수행 능력을 향상시키는 것**

- 즉, 하나의 프로그램에 동시에 여러개의 일을 수행할수 있도록 해주는 것
- 하나의 프로세스 내 **메모리와 자원을 공유**한다.
- 메모리의 **code, data, heap 영역은 공유**하고, **stack과 PC 레지스터는 따로 할당**받는다.
  - **각 스레드는 독립적으로 수행**되어야 하기 때문.
- **장점**
  - **응답시간 단축** : 여러 스레드로 분할되면 하나의 스레드가 실행을 완료될 때 즉시 출력 반환 가능
  - **빠른 통신** : 동일한 메모리 영역을 공유해서 여러 쓰레드 간 통신이 원활함
  - **빠른 문맥 교환** : 프로세스에 비해 캐시 메모리를 비울 필요가 없기 때문.
  - **시스템 처리량 향상** : 각 스레드 기능을 하나의 작업으로 간주하면서 단위 시간당 완료되는 작업 수 증가함
- **문제점**
  - **동기화 문제**
    - 공유하는 자원에 동시에 접근하는 경우, 프로세스와 달리 **데이터와 힙 영역**을 공유하기 때문에 어떤 쓰레드가 다른 쓰레드에서 사용중인 변수나 자료 구조에 접근하여 엉뚱한 값을 읽어오거나 수정할 수 있다. 따라서 동기화가 필요!
    - 동기화를 통해 작업 처리 순서와 공유 자원에 대한 접근을 컨트롤할 수 있다. 그러나 불필요한 부분까지 동기화를 하면 과도한 lock으로 인해 병목 현상이 병목 현상이 발생해 성능 저하 가능성 높다.
  - 구현이 어려움
  - 테스트, 디버깅하기 어려움
  - 하나의 스레드의 문제가 발생하면 전체 프로세스에 영향을 끼침
- 사용 사례
  - 영상통신 : 영상을 받아 화면에 출력하는 작업과 영상을 생성하여 보여주는 작업이 동시에 발생
  - 웹 브라우저 : UI를 처리하는 작업과 표시할 데이터를 가져오는 작업이 동시에 발생
  - 게임 : 그래픽을 실행하는 작업과 UI를 그리는 서버통신을 담당하는 소켓 작업이 동시에 발생

## 프로세스와 스레드 차이점

|                | 프로세스           | 스레드                                 |
| -------------- | ------------------ | -------------------------------------- |
| 정의           | 프로그램이 실행 중 | 프로세스의 세그먼트                    |
| 프로세스 타입  | 중량 프로세스      | 경량 프로세스                          |
| 종료 시간      | 많은 시간 소요     | 적은 시간 소요                         |
| 생성 시간      | 많은 시간 소요     | 적은 시간 소요                         |
| 문맥 교환 시간 | 많은 시간 소요     | 적은 시간 소요                         |
| 메모리 공유    | 비공유             | 공유. 단, stack과 PC 레지스터는 비공유 |



## Reference

- https://javaconceptoftheday.com/differences-between-program-vs-process-vs-threads/
- https://www.guru99.com/program-vs-process-difference.html#3
- https://binaryterms.com/process-control-block-pcb.html
- https://www.geeksforgeeks.org/thread-in-operating-system/?ref=lbp
- https://www.guru99.com/difference-between-process-and-thread.html
- https://goodgid.github.io/What-is-Multi-Thread/

