# 메모리 관리
## 요약
- 메모리란 프로그램이 필요한 주소, 정보들을 저장해서 사용할 수 있는 공간
- 프로세스는 각각의 독립된 공간을 갖기 때문에 많은 프로그램을 동시에 실행하기 위해 효율적인 사용과 관리가 필요
- 물리 메모리의 크기 한계를 극복하고 더 많은 프로그램을 동시에 실행하기 위해 가상 메모리 적용
- 단편화란 사용 가능한 메모리가 충분히 존재하지만 할당하지 못하는 상태를 말함
- 내부 단편화는 프로세스가 사용 가용한 공간에 남는 포함된 남는 공간을 말하며 외부 단편화는 프로세스 사이 사이에 남는 공간을 의미

## 메모리 관리
### 메모리란?
- RAM
- 프로그램이 필요한 주소, 정보들을 저장해서 사용할 수 있게 만드는 공간
- 프로세스는 운영체제 혹은 다른 프로세스의 메모리 공간에 접근할 수 없는 제한이 걸려있음
- OS만이 OS 메모리와 사용자 메모리 영역에 접근이 가능하기 때문에 OS가 메모리를 관리

### 멀티 프로그래밍
- 프로세서가 입출력 작업의 종료를 대기할 동안 하나의 프로세서에서 다른 프로그램을 수행할 수 있도록 하는 환경
- 여러 프로세서가 동시에 동작

### 메모리 관리가 필요한 이유
- 각각의 프로세스는 독립된 공간을 가짐
- 멀티 프로그래밍 환경 -> 여러 프로세서가 메모리를 함께 사용
- 한정된 메모리를 효율적으로 사용해야함 -> VM
- 운영체제의 효율적인 관리 필요 -> 단편화 관리
	- 실행파일이 로더에 의해 메모리에 올라오면, 운영체제는 이 실행파일을 어느 메모리에 올릴지 결정하기 때문


## 가상 메모리 (Virtual Memory, VM)
### 물리 메모리의 한계
- 모든 프로그램 코드를 물리 메모리에 올릴 수 없음
- 프로그램을 교체하면서 올리면 메모리 교체 성능 문제 발생

### 가상 메모리란?
- 실제 물리 메모리 개념과 사용자의 논리 메모리 개념을 분리한 것
- 가상 주소 공간 : 하나의 프로세스가 메모리에 저장되는 논리적인 모습을 가상 메모리에 구현한 공간
- 가상 주소 : 해당 공간을 가리키는 주소

### 가상 메모리가 필요한 이유
- 물리 메모리보다 큰 프로세스를 수행하기 위해 사용 -> 물리 메모리 크기의 한계를 극복
- 프로그램의 필요한 부분만 메모리에 적재
- 페이지 혹은 세그먼트 단위일 수 있으나 현재 대부분은 페이지 단위 사용

### 가상 메모리의 장점
- 물리 메모리 크기의 한계를 극복
- 전체 프로그램이 물리 메모리에 올라와 있지 않음
- 더 많은 프로그램을 동시에 실행
	- 응답 시간 유지, CPU 이용률과 처리량 증가

### 가상 메모리 구현
- 메인 메모리(주기억장치)와 디스크의 페이징 스페이스(보조기억장치)를 묶어 하나의 메모리처럼 동작
![가상 메모리](https://github.com/leeejuhyeong/images/blob/main/no-study-no-future/OS/virtual_memory.png?raw=true)  
  
> Paing Space : 메인 메모리가 부족 시 사용되는 디스크 공간  


## Swapping
### Swapping이란
- 메모리 관리를 위해 사용되는 기법
- 메모리에 적재되어 있으나 현재 사용되지 않고 있는 프로세스를 관리
	- CPU 할당 시간이 끝난 프로세스의 메모리(Round-Robin과 같은 스케줄링)
	- CPU에서 실행되지 않는 프로세스
- 프로세스 일부를 보조기억장치(Backing Store)로 내보내고 다른 프로세스의 메모리를 불러 들임
- Swap-In : 주 기억장치로 불러오는 과정
- Swap-Out : 보조 기억장치로 내보내는 과정
![swapping](https://github.com/leeejuhyeong/images/blob/main/no-study-no-future/OS/swapping.png?raw=true)  
  

## 단편화 현상
### 단편화란?
- 메모리의 공간이 작은 조각으로 나뉘어 사용 가능한 메모리가 충분히 존재하지만 할당(사용)이 불가능한 상태

### 외부 단편화
- 메모리 공간 중 사용하지 못하게 되는 일부분
- 물리 메모리(RAM)에서 사이사이 남는 공간들을 모두 합치면 충분한 공간이 되지만 사용할 수 없음
![외부 단편화](https://github.com/leeejuhyeong/images/blob/main/no-study-no-future/OS/external_fragmentation.png?raw=true)  
  
### 내부 단편화
- 프로세스가 사용하는 메모리 공간에 포함된 남는 부분
![내부 단편화](https://github.com/leeejuhyeong/images/blob/main/no-study-no-future/OS/internal_fragmentation.png?raw=true)  
  
  
## 메모리 관리 기법
### 종류
- **연속 메모리 할당**
- 비연속 메모리 할당

### 연속 메모리 할당
- 고정 분할 기법 : 주기억장치가 고정된 파티션으로 분할 -> 내부 단편화 발생
- 동적 분할 기법 : 파티션들이 동적 생성되며 자신의 크기와 같은 파티션에 적재 -> 외부 단편화 발생

### 연속 메모리 할당 배치 방법
#### 최초 적합(First fit)
- 가장 처음 만나는 빈 메모리 공간에 프로세스를 할당

#### 최적 적합(Best fit)
- 빈 메모리 공간의 크기와 프로세스의 크기 차이가 가장 적은 곳에 프로세스를 할당

#### 최악 적합(Worst fit)
- 빈 메모리 공간의 크기와 프로세스의 크기 차이가 가장 큰 곳에 프로세스를 할당
- 남는 공간에 또 다른 프로세스를 할당할 수 있을 거라는 가정에 기인


## 앞으로..
### 비연속 메모리 할당
- 페이징, 세그먼트

### 요구 페이지 기법
- 메모리 과할당, 페이지 부재
- 페이지 교체 알고리즘

### 캐시 메모리


## 정리
### 정의
#### CPU
-  연산, 수행, 그리고 프로그램을 실행하는 주체
#### 메모리
- 프로그램이 필요한 주소, 정보들을 저장해서 사용할 수 있게 만드는 공간
#### 프로세스
- 주 메모리에 올라와(load) 실행되고 있는 프로그램
- OS에 의해 실행에 필요한 자원인 메모리를 할당받음
#### PCB
- 프로세스의 정보가 저장됨
- 프로그램의 상태, 다음 실행할 명령어 주소 등을 보관
- 커널에 저장

### Context Switching VS Swapping
#### context switching
- CPU와 메모리 사이에서 발생
- 작업하고 있는 Task에서 인터럽트가 발생해 다른 Task로 교체하는 과정
#### swapping
- 주 기억장치(RAM)과 보조 기억장치(하드 디스크) 사이에서 발생
- 메모리 관리를 위해 사용되는 기법
- 현재 사용되지 않고 있는 프로세스를 관리하는 역할

### Swapping VS Demanding Paging
#### 공통점
- 주기억장치와 보조기억장치 사이를 오가는 기능
#### 차이점
- Swapping
	- 프로세스 단위로 이동
- Demanding Paging
	- 페이지 단위로 이동

## 출처
- [운영체제 OS 메모리 관리란? - 이유, 방법](https://technote-mezza.tistory.com/92)
- [운영체제(OS) 15. 가상메모리](https://velog.io/@codemcd/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-15.-%EA%B0%80%EC%83%81%EB%A9%94%EB%AA%A8%EB%A6%AC)
- [운영체제 페이징과 세그멘테이션](https://steady-coding.tistory.com/524)
- [운영체제Swapping 스와핑(Swap 스왑)이란? 프로세스 교체, VMM과 차이](https://jhnyang.tistory.com/103)
- [운영체제 메모리 분할 ( Memory Partioning )  연속 메모리 할당 ](https://lordofkangs.tistory.com/203)